{% extends 'base.html' %}

{% block content %}

<div class="max-w-5xl mx-auto">
    <div class="mb-6">
        <a href="#" onclick="history.back()" class="text-sm text-gray-400 hover:text-red-600 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Kembali ke Episode
        </a>
    </div>

    <div class="bg-black rounded-xl overflow-hidden shadow-lg aspect-video relative">
        {% if stream.error %}
            <div class="absolute inset-0 flex flex-col items-center justify-center text-white p-4 text-center">
                <i class="fas fa-exclamation-circle text-4xl text-red-600 mb-4"></i>
                <p class="text-xl font-bold mb-2">Gagal Memuat Video</p>
                <p class="text-gray-400">{{ stream.error }}</p>
            </div>
        {% elif stream.type == 'mp4' %}
            <video controls width="100%" height="100%" class="w-full h-full object-contain" autoplay>
                <source src="{{ stream.url }}" type="video/mp4">
                Browser Anda tidak mendukung tag video.
            </video>
        {% elif stream.type == 'm3u8' %}
            <video id="video-player" controls class="w-full h-full object-contain"></video>
            <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
            <script>
                var video = document.getElementById('video-player');
                var videoSrc = '{{ stream.url }}';
                if (Hls.isSupported()) {
                    var hls = new Hls();
                    hls.loadSource(videoSrc);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = videoSrc;
                    video.addEventListener('loadedmetadata', function() {
                        video.play();
                    });
                }
            </script>
        {% elif stream.type == 'iframe' %}
            <iframe src="{{ stream.url }}" class="w-full h-full border-0" allowfullscreen allow="autoplay; encrypted-media"></iframe>
        {% endif %}
    </div>

    <div class="mt-6 bg-white p-6 rounded-xl border border-gray-200">
        <h1 class="text-xl font-bold text-gray-900">Sedang Menonton</h1>
        <p class="text-gray-400 text-sm mt-1">{{ episode_url }}</p>
    </div>
</div>

{% endblock %}
